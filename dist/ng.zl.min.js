angular.module("ng.zl",["ng","ngSanitize","ngMaterial","ng.zl.sha256","ng.zl.templates"]),angular.module("ng.zl.templates",[]).run(["$templateCache",function(e){e.put("views/grid.edit.html",'<div class="zl-grid-edit" ng-dblclick="onEdit($event)">\r\n    <span ng-bind="gridModel" ng-show="!edit"></span>\r\n    <input type="text" tabindex="-1" ng-model="gridModel" ng-show="edit" ng-blur="cancelEdit($event)" ng-keyup="onKey($event)" zl-focus-on="zlGridEditInput"/>\r\n</div>'),e.put("views/grid.edit.select.html",'<div class="zl-grid-edit" ng-dblclick="onEdit($event)">\r\n    <span ng-bind="gridModel" ng-show="!edit"></span>\r\n    <select tabindex="-1" ng-model="selected" ng-show="edit" zl-focus-on="zlGridEditSelect" ng-blur="cancelEdit($event)" ng-options="value.name for value in selects" ng-change="onChange($event)" ng-keyup="onKey($event)">\r\n    </select>\r\n</div>'),e.put("views/grid.edit.switch.html",'<div class="zl-grid-edit" ng-dblclick="onEdit($event)">\r\n    <span ng-bind="gridModel" ng-show="!edit"></span>\r\n\r\n    <md-switch class="md-primary" tabindex="-1" ng-model="gridModel" aria-label="Switch" zl-focus-on="zlGridEditSwitch" ng-show="edit" ng-blur="cancelEdit($event)" ng-keyup="onKey($event)" ng-change="onChange($event)"></md-switch>\r\n\r\n</div>'),e.put("views/grid.html",'<div class="zl-grid">\r\n    <table class="table table-striped table-hover table-condensed">\r\n        <thead>\r\n        <tr>\r\n            <th ng-if="config.enableSelect" class="zl-grid-select">\r\n                <md-checkbox ng-click="onCheckAll($event)"></md-checkbox>\r\n            </th>\r\n            <th ng-repeat="col in config.columns" ng-bind="col.name"></th>\r\n            <th ng-if="config.actions.length > 0">操作</th>\r\n        </tr>\r\n        </thead>\r\n        <tbody>\r\n        <tr ng-repeat="data in config.data">\r\n            <td ng-if="config.enableSelect" class="zl-grid-select">\r\n                <md-checkbox ng-model="data._checked"></md-checkbox>\r\n            </td>\r\n            <td ng-repeat="col in config.columns">\r\n                <span ng-if="!col.edit && col.render" style="{{col.style}}">\r\n                    <div zl-compile html="{{col.render(data[col.field])}}"></div>\r\n                </span>\r\n                <span ng-if="!col.edit && !col.render" ng-bind="data[col.field]" style="{{col.style}}"></span>\r\n\r\n                <div ng-if="col.edit && col.editType === \'input\'">\r\n                    <div zl-grid-edit grid-model="data[col.field]" grid-after-edit="onAfterEdit(value, col, data)"></div>\r\n                </div>\r\n                <div ng-if="col.edit && col.editType === \'select\'">\r\n                    <div zl-grid-edit-select grid-model="data[col.field]" grid-edit-type="col.editType" grid-edit-data="col.editData()" grid-after-edit="onAfterEdit(value, col, data)"></div>\r\n                </div>\r\n                <div ng-if="col.edit && col.editType === \'switch\'">\r\n                    <div zl-grid-edit-switch grid-model="data[col.field]" grid-after-edit="onAfterEdit(value, col, data)"></div>\r\n                </div>\r\n            </td>\r\n\r\n            <td ng-if="config.actions.length > 0">\r\n                <md-button ng-repeat="act in config.actions" class="md-raised {{act.className}}" ng-bind="act.html"\r\n                           ng-click="act.action(data, config.data, $event)"></md-button>\r\n            </td>\r\n        </tr>\r\n        </tbody>\r\n    </table>\r\n    <div layout="row">\r\n        <md-button class="md-raised" ng-click="getData()" ng-if="config.next">More</md-button>\r\n        <md-button class="md-raised" ng-if="!config.next" ng-disabled="true">No More</md-button>\r\n        <div flex ng-if="config.enableSelect && config.actions.length > 0">\r\n            <md-button ng-repeat="act in config.actions" class="md-raised {{act.className}}" ng-bind="act.html"\r\n                       ng-click="onBatch(act, $event)"></md-button>\r\n        </div>\r\n    </div>\r\n</div>'),e.put("views/progress.html",'<div class="zl-progress" ng-if="show">\r\n    <md-progress-circular md-mode="indeterminate"></md-progress-circular>\r\n</div>'),e.put("views/scroll.html",'<div class="zl-scroll">\r\n    <div ng-show="isShow">\r\n    <md-button class="md-fab md-primary md-mini" ng-click="onTop()" ng-if="top">\r\n        t\r\n    </md-button>\r\n\r\n    <md-button class="md-fab md-primary md-mini" ng-click="onBottom()" ng-if="bottom">\r\n        b\r\n    </md-button>\r\n    </div>\r\n</div>'),e.put("views/toast.html",'<div class="zl-toast-container">\r\n    <md-toast ng-repeat="t in list" class="md-default-theme">\r\n        <span ng-bind="t.word"></span>\r\n    </md-toast>\r\n</div>')}]),angular.module("ng.zl").directive("zlCompile",["$compile",function(e){"use strict";return{replace:!0,restrict:"A",link:function(t,i,n){if(n.html){var o=e(n.html)(t);i.replaceWith(o)}}}}]),angular.module("ng.zl").directive("zlDyCompile",["$compile",function(e){"use strict";return{replace:!0,restrict:"A",link:function(t,i,n){var o,r={$destroy:angular.noop},l=i,a=function(){(o||r).$destroy()};n.$observe("html",function(i){if(i){a(),o=t.$new(!0);var n=e(i)(t);l.replaceWith(n),l=n}t.$on("$destroy",a)})}}}]),angular.module("ng.zl").directive("zlFocusOn",function(){"use strict";return function(e,t,i){return e.$on("zlFocusOn",function(e,n){return n===i.zlFocusOn?t[0].focus():void 0})}}),angular.module("ng.zl.grid",["ng.zl"]).directive("zlGrid",["$zl",function(e){"use strict";return{restrict:"A",replace:!0,scope:{config:"="},templateUrl:"views/grid.html",controller:["$scope",function(t){_.each(t.config.columns,function(e){e.edit&&(e.afterEdit=e.afterEdit||function(){})}),t.config=_.extend({enableSelect:!1,columns:null,data:[],next:null,actions:[]},t.config),t.checkAll=!1,t.onCheckAll=function(){t.checkAll=!t.checkAll,_.each(t.config.data,function(e){e._checked=t.checkAll})},t.onBatch=function(e,i){var n=_.filter(t.config.data,function(e){return e._checked});n.length>0&&e.batch(n,t.config.data,i)},t.onAfterEdit=function(t,i,n){if(t.newValue!==t.oldValue){var o=i.afterEdit(n,i,t.newValue,t.oldValue);o&&o.then(function(){e.tips("修改成功")},function(){e.tips("修改失败"),n[i.field]=t.oldValue})}},t.onEditData=function(e){return e.editData()},t.getData=function(){t.config.getData(t.config.next).then(function(e){_.each(e,function(e,i){"pageOffset"!==i&&"pageAnchor"!==i&&(t.config.data=t.config.data.concat(e||[]))}),t.config.next=e.nextPageOffset||e.nextPageAnchor})},t.getData()}]}}]).directive("zlGridEdit",["$zlFocusOn","$timeout",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{gridModel:"=",gridAfterEdit:"&"},templateUrl:"views/grid.edit.html",controller:["$scope","$element",function(i,n){i.edit=!1;var o=i.gridModel;n.closest("td").width(n.width()),i.onEdit=function(t){n.addClass("zl-grid-edit-on"),i.edit=!0,e("zlGridEditInput")},i.cancelEdit=function(e){i.edit=!1},i.onKey=function(e){13===e.keyCode?(i.edit=!1,i.gridModel=e.target.value,t(function(){i.gridAfterEdit({value:{newValue:i.gridModel,oldValue:o}})},1)):27===e.keyCode&&(i.edit=!1,i.gridModel=o)}}]}}]).directive("zlGridEditSelect",["$zlFocusOn","$timeout",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{gridModel:"=",gridAfterEdit:"&",gridEditType:"@",gridEditData:"&"},templateUrl:"views/grid.edit.select.html",controller:["$scope","$element",function(i,n){i.edit=!1;var o=i.gridModel;i.selects=[],i.selected=null,i.gridEditData().then(function(e){i.selects=e,i.selected=_.find(e,function(e){return e.value===i.gridModel})}),n.closest("td").width(n.width()),i.onEdit=function(t){n.addClass("zl-grid-edit-on"),i.edit=!0,e("zlGridEditSelect")},i.cancelEdit=function(){i.edit=!1},i.onKey=function(){27===event.keyCode&&(i.edit=!1,i.gridModel=o)},i.onChange=function(e){i.edit=!1,i.gridModel=i.selected.value,t(function(){i.gridAfterEdit({value:{newValue:i.gridModel,oldValue:o}})},1)}}]}}]).directive("zlGridEditSwitch",["$zlFocusOn","$timeout",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{gridModel:"=",gridAfterEdit:"&"},templateUrl:"views/grid.edit.switch.html",controller:["$scope","$element",function(i,n){i.edit=!1,i.gridModel=i.gridModel||!1;var o=i.gridModel;n.closest("td").width(n.width()),i.onEdit=function(t){n.addClass("zl-grid-edit-on"),i.edit=!0,e("zlGridEditSwitch")},i.cancelEdit=function(e){i.edit=!1},i.onKey=function(e){27===e.keyCode&&(i.edit=!1,i.gridModel=o)},i.onChange=function(e){i.edit=!1,t(function(){i.gridAfterEdit({value:{newValue:i.gridModel,oldValue:o}})},1)}}]}}]),angular.module("ng.zl").directive("zlScroll",["$zl","$mdMedia",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{},templateUrl:"views/scroll.html",controller:["$scope","$element",function(i,n){var o=n.attr("zl-scroll");o.indexOf("scroll-top")>-1&&(i.top=!0),o.indexOf("scroll-bottom")>-1&&(i.bottom=!0),i.onTop=function(){e.scroll.top()},i.onBottom=function(){e.scroll.bottom()},i.isShow=t("gt-md")}]}}]),angular.module("ng.zl").factory("$zlFocusOn",["$rootScope","$timeout",function(e,t){"use strict";return function(i){return t(function(){return e.$broadcast("zlFocusOn",i)})}}]),angular.module("ng.zl").factory("$zl",["$mdDialog","$mdToast","$compile","$rootScope","$templateRequest","$timeout","$zlSha256","$q",function(e,t,i,n,o,r,l,a){"use strict";var u=$(document.body),d=function(t,i,n){var o=e.alert().parent(u).title(i).content(t).ok("ok");return n&&(o=o.targetEvent(n)),e.show(o)},s=function(t,i,n,o,r){o=o||"ok",r=r||"cancel";var l=e.confirm().parent(u).title(i).content(t).ok(o).cancel(r);return n&&(l=l.targetEvent(n)),e.show(l)},c=null,f=n.$new();f.list=[];var p=function(e,t,n){var l=a.defer();c||(c=!0,o("views/toast.html").then(function(e){c=$(e),$(document.body).append(c),i(c)(f)}));var u=+new Date;return f.list.unshift({word:e,_key_:u}),r(function(){f.list.splice(f.list.indexOf(_.find(f.list,function(e){return e._key_===u})),1),l.resolve({})},n||4e3),l.promise},m=null,g=n.$new();g.show=!1;var h={start:function(){m||(m=!0,o("views/progress.html").then(function(e){m=$(e),$(document.body).append(m),i(m)(g)})),g.show=!0},done:function(){g.show=!1}},v={set:function(e){var t=$(".site-content")[0];t.scrollTop=e},top:function(){v.set(0)},bottom:function(){v.set($(document.body).height())},page:function(){v.set(document.body.scrollTop+document.documentElement.clientHeight)}},E=function(e,t){var i=e;return arguments.length<2?i:i=i.replace(/\{([\d\w\.]+)\}/g,function(e){var i=arguments[1].split("."),n=null;return _.each(i,function(e,i){n=i?n[e]:t[e]}),n})},y=null,b={set:function(e){y=e},get:function(){return y}},q={alert:d,confirm:s,tips:p,progress:h,scroll:v,format:E,sha256:l,userInfo:b};return window.ZL=q,q}]),angular.module("ng.zl.sha256",[]).factory("$zlSha256",function(){"use strict";var e=function(e){function t(e,t){return t>>>e|t<<32-e}function i(e,t,i){return e&t^~e&i}function n(e,t,i){return e&t^e&i^t&i}function o(e){return t(2,e)^t(13,e)^t(22,e)}function r(e){return t(6,e)^t(11,e)^t(25,e)}function l(e){return t(7,e)^t(18,e)^e>>>3}function a(e){return t(17,e)^t(19,e)^e>>>10}function u(e,t){return e[15&t]+=a(e[t+14&15])+e[t+9&15]+l(e[t+1&15])}function d(e,t){var i=(65535&e)+(65535&t),n=(e>>16)+(t>>16)+(i>>16);return n<<16|65535&i}function s(){h=new Array(8),v=new Array(2),E=new Array(64),v[0]=v[1]=0,h[0]=1779033703,h[1]=3144134277,h[2]=1013904242,h[3]=2773480762,h[4]=1359893119,h[5]=2600822924,h[6]=528734635,h[7]=1541459225}function c(){var e,t,l,a,s,c,f,p,m,g,v=new Array(16);e=h[0],t=h[1],l=h[2],a=h[3],s=h[4],c=h[5],f=h[6],p=h[7];for(var b=0;16>b;b++)v[b]=E[(b<<2)+3]|E[(b<<2)+2]<<8|E[(b<<2)+1]<<16|E[b<<2]<<24;for(var q=0;64>q;q++)m=p+r(s)+i(s,c,f)+y[q],m+=16>q?v[q]:u(v,q),g=o(e)+n(e,t,l),p=f,f=c,c=s,s=d(a,m),a=l,l=t,t=e,e=d(m,g);h[0]+=e,h[1]+=t,h[2]+=l,h[3]+=a,h[4]+=s,h[5]+=c,h[6]+=f,h[7]+=p}function f(e,t){var i,n,o=0;n=v[0]>>3&63;var r=63&t;for((v[0]+=t<<3)<t<<3&&v[1]++,v[1]+=t>>29,i=0;t>i+63;i+=64){for(var l=n;64>l;l++)E[l]=e.charCodeAt(o++);c(),n=0}for(var l=0;r>l;l++)E[l]=e.charCodeAt(o++)}function p(){var e=v[0]>>3&63;if(E[e++]=128,56>=e)for(var t=e;56>t;t++)E[t]=0;else{for(var t=e;64>t;t++)E[t]=0;c();for(var t=0;56>t;t++)E[t]=0}E[56]=v[1]>>>24&255,E[57]=v[1]>>>16&255,E[58]=v[1]>>>8&255,E[59]=255&v[1],E[60]=v[0]>>>24&255,E[61]=v[0]>>>16&255,E[62]=v[0]>>>8&255,E[63]=255&v[0],c()}function m(){for(var e=new String,t=0;8>t;t++)for(var i=28;i>=0;i-=4)e+=b.charAt(h[t]>>>i&15);return e}function g(e){return s(),f(e,e.length),p(),m()}var h,v,E,y=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),b="0123456789abcdef";return g(e)};return e}),angular.module("ng.zl.uploader",[]).service("$zlUploader",["$log","$q",function(e,t){"use strict";var i=function(e,i){var n=t.defer(),o=$(e),r=$.extend({height:37,buttonText:"上传",buttonClass:"zl-btn-upload",removeCompleted:!0},i);if(""===o[0].id)throw"container id ?";if(r.url)throw" url ?";return o.uploadifive(r),n.promise},n=function(e,t){return t=$.extend({fileObjName:"attachment",buttonText:"上传文件",multi:!1},t),i(e,t)},o=function(e,t){return t=$.extend({fileObjName:"Filename",buttonText:"上传图片",multi:!1}),i(e,t)};return{fileUpload:n,imgUpload:o}}]),function(e){var t={init:function(n){return this.each(function(){var o=e(this);o.data("uploadifive",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var r=o.data("uploadifive"),l=r.settings=e.extend({auto:!0,buttonClass:!1,buttonText:"Select Files",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:0,fileType:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,queueSizeLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,uploadScript:"uploadifive.php",width:100},n);if(isNaN(l.fileSizeLimit)){var a=1.024*parseInt(l.fileSizeLimit);l.fileSizeLimit.indexOf("KB")>-1?l.fileSizeLimit=1e3*a:l.fileSizeLimit.indexOf("MB")>-1?l.fileSizeLimit=1e6*a:l.fileSizeLimit.indexOf("GB")>-1&&(l.fileSizeLimit=1e9*a)}else l.fileSizeLimit=1024*l.fileSizeLimit;if(r.inputTemplate=e('<input type="file">').css({"font-size":l.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999}),r.createInput=function(){var i=r.inputTemplate.clone(),n=i.name="input"+r.inputCount++;l.multi&&i.attr("multiple",!0),l.fileType&&i.attr("accept",l.fileType),i.bind("change",function(){r.queue.selected=0,r.queue.replaced=0,r.queue.errors=0,r.queue.queued=0;var i=this.files.length;if(r.queue.selected=i,r.queue.count+i>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(o,"QUEUE_LIMIT_EXCEEDED");else{for(var a=0;i>a;a++)file=this.files[a],r.addQueueItem(file);r.inputs[n]=this,r.createInput()}l.auto&&t.upload.call(o),"function"==typeof l.onSelect&&l.onSelect.call(o,r.queue)}),r.currentInput&&r.currentInput.hide(),r.button.append(i),r.currentInput=i},r.destroyInput=function(t){e(r.inputs[t]).remove(),delete r.inputs[t],r.inputCount--},r.drop=function(i){r.queue.selected=0,r.queue.replaced=0,r.queue.errors=0,r.queue.queued=0;var n=i.dataTransfer,a=n.name="input"+r.inputCount++,u=n.files.length;if(r.queue.selected=u,r.queue.count+u>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(o,"QUEUE_LIMIT_EXCEEDED");else{for(var d=0;u>d;d++)file=n.files[d],r.addQueueItem(file);r.inputs[a]=n}l.auto&&t.upload.call(o),"function"==typeof l.onDrop&&l.onDrop.call(o,n.files,n.files.length),i.preventDefault(),i.stopPropagation()},r.fileExistsInQueue=function(e){for(var t in r.inputs){input=r.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)if(existingFile=input.files[i],existingFile.name==e.name&&!existingFile.complete)return!0}return!1},r.removeExistingFile=function(e){for(var i in r.inputs){input=r.inputs[i],limit=input.files.length;for(var n=0;n<limit;n++)existingFile=input.files[n],existingFile.name!=e.name||existingFile.complete||(r.queue.replaced++,t.cancel.call(o,existingFile,!0))}},r.queueItem=e(0==l.itemTemplate?'<div class="uploadifive-queue-item">\r\n                        <a class="close" href="#">X</a>\r\n                        <div><span class="filename"></span><span class="fileinfo"></span></div>\r\n                        <div class="progress">\r\n                            <div class="progress-bar"></div>\r\n                        </div>\r\n                    </div>':l.itemTemplate),r.addQueueItem=function(i){if(e.inArray("onAddQueueItem",l.overrideEvents)<0){r.removeExistingFile(i),i.queueItem=r.queueItem.clone(),i.queueItem.attr("id",l.id+"-file-"+r.fileID++),i.queueItem.find(".close").bind("click",function(){return t.cancel.call(o,i),!1});var n=i.name;n.length>l.truncateLength&&0!=l.truncateLength&&(n=n.substring(0,l.truncateLength)+"..."),i.queueItem.find(".filename").html(n),i.queueItem.data("file",i),r.queueEl.append(i.queueItem)}"function"==typeof l.onAddQueueItem&&l.onAddQueueItem.call(o,i),i.size>l.fileSizeLimit&&0!=l.fileSizeLimit?r.error("FILE_SIZE_LIMIT_EXCEEDED",i):(r.queue.queued++,r.queue.count++)},r.removeQueueItem=function(t,i,n){n||(n=0);var o=i?0:500;t.queueItem&&(" - Completed"!=t.queueItem.find(".fileinfo").html()&&t.queueItem.find(".fileinfo").html(" - Cancelled"),t.queueItem.find(".progress-bar").width(0),t.queueItem.delay(n).fadeOut(o,function(){e(this).remove()}),delete t.queueItem,r.queue.count--)},r.filesToUpload=function(){var e=0;for(var t in r.inputs){input=r.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)file=input.files[i],file.skip||file.complete||e++}return e},r.checkExists=function(i){if(e.inArray("onCheck",l.overrideEvents)<0){e.ajaxSetup({async:!1});var n=e.extend(l.formData,{filename:i.name});if(e.post(l.checkScript,n,function(e){i.exists=parseInt(e)}),i.exists&&!confirm("A file named "+i.name+" already exists in the upload folder.\nWould you like to replace it?"))return t.cancel.call(o,i),!0}return"function"==typeof l.onCheck&&l.onCheck.call(o,i,i.exists),!1},r.uploadFile=function(t,n){if(!t.skip&&!t.complete&&!t.uploading)if(t.uploading=!0,r.uploads.current++,r.uploads.attempted++,xhr=t.xhr=new XMLHttpRequest,"function"==typeof FormData||"object"==typeof FormData){var a=new FormData;a.append(l.fileObjName,t);for(i in l.formData)a.append(i,l.formData[i]);xhr.open(l.method,l.uploadScript,!0),xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&r.progress(e,t)},!1),xhr.addEventListener("load",function(e){4==this.readyState&&(t.uploading=!1,200==this.status?"Invalid file type."!==t.xhr.responseText?r.uploadComplete(e,t,n):r.error(t.xhr.responseText,t,n):404==this.status?r.error("404_FILE_NOT_FOUND",t,n):403==this.status?r.error("403_FORBIDDEN",t,n):r.error("Unknown Error",t,n))}),xhr.send(a)}else{var u=new FileReader;u.onload=function(i){var a="-------------------------"+(new Date).getTime(),u="--",d="\r\n",s="";s+=u+a+d,s+='Content-Disposition: form-data; name="'+l.fileObjName+'"',t.name&&(s+='; filename="'+t.name+'"'),s+=d,s+="Content-Type: application/octet-stream"+d+d,s+=i.target.result+d;for(key in l.formData)s+=u+a+d,s+='Content-Disposition: form-data; name="'+key+'"'+d+d,s+=l.formData[key]+d;s+=u+a+u+d,xhr.upload.addEventListener("progress",function(e){r.progress(e,t)},!1),xhr.addEventListener("load",function(e){t.uploading=!1;var i=this.status;404==i?r.error("404_FILE_NOT_FOUND",t,n):"Invalid file type."!=t.xhr.responseText?r.uploadComplete(e,t,n):r.error(t.xhr.responseText,t,n)},!1);var c=l.uploadScript;if("get"==l.method){var f=e(l.formData).param();c+=f}xhr.open(l.method,l.uploadScript,!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+a),"function"==typeof l.onUploadFile&&l.onUploadFile.call(o,t),xhr.sendAsBinary(s)},u.readAsBinaryString(t)}},r.progress=function(t,i){if(e.inArray("onProgress",l.overrideEvents)<0){if(t.lengthComputable)var n=Math.round(t.loaded/t.total*100);i.queueItem.find(".fileinfo").html(" - "+n+"%"),i.queueItem.find(".progress-bar").css("width",n+"%")}"function"==typeof l.onProgress&&l.onProgress.call(o,i,t)},r.error=function(i,n,a){if(e.inArray("onError",l.overrideEvents)<0){switch(i){case"404_FILE_NOT_FOUND":errorMsg="404 Error";break;case"403_FORBIDDEN":errorMsg="403 Forbidden";break;case"FORBIDDEN_FILE_TYPE":errorMsg="Forbidden File Type";break;case"FILE_SIZE_LIMIT_EXCEEDED":errorMsg="File Too Large";break;default:errorMsg="Unknown Error"}n.queueItem.addClass("error").find(".fileinfo").html(" - "+errorMsg),n.queueItem.find(".progress").remove()}"function"==typeof l.onError&&l.onError.call(o,i,n),n.skip=!0,"404_FILE_NOT_FOUND"==i?r.uploads.errors++:r.queue.errors++,a&&t.upload.call(o,null,!0)},r.uploadComplete=function(i,n,a){e.inArray("onUploadComplete",l.overrideEvents)<0&&(n.queueItem.find(".progress-bar").css("width","100%"),n.queueItem.find(".fileinfo").html(" - Completed"),n.queueItem.find(".progress").slideUp(250),n.queueItem.addClass("complete")),"function"==typeof l.onUploadComplete&&l.onUploadComplete.call(o,n,n.xhr.responseText),l.removeCompleted&&setTimeout(function(){t.cancel.call(o,n)},3e3),n.complete=!0,r.uploads.successful++,r.uploads.count++,r.uploads.current--,delete n.xhr,a&&t.upload.call(o,null,!0)},r.queueComplete=function(){"function"==typeof l.onQueueComplete&&l.onQueueComplete.call(o,r.uploads)},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof l.onFallback&&l.onFallback.call(o),!1;if(l.id="uploadifive-"+o.attr("id"),r.button=e('<div id="'+l.id+'" class="uploadifive-button">'+l.buttonText+"</div>"),l.buttonClass&&r.button.addClass(l.buttonClass),r.button.css({height:l.height,"line-height":l.height+"px",overflow:"hidden",position:"relative","text-align":"center",width:l.width}),o.before(r.button).appendTo(r.button).hide(),r.createInput.call(o),l.queueID?r.queueEl=e("#"+l.queueID):(l.queueID=l.id+"-queue",r.queueEl=e('<div id="'+l.queueID+'" class="uploadifive-queue" />'),r.button.after(r.queueEl)),l.dnd){var u=l.dropTarget?e(l.dropTarget):r.queueEl.get(0);u.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("drop",r.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var i=Array.prototype.map.call(e,t),n=new Uint8Array(i);this.send(n.buffer)}),"function"==typeof l.onInit&&l.onInit.call(o)})},debug:function(){return this.each(function(){console.log(e(this).data("uploadifive"))})},clearQueue:function(){this.each(function(){var n=e(this),o=n.data("uploadifive"),r=o.settings;for(var l in o.inputs)for(input=o.inputs[l],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],t.cancel.call(n,file);"function"==typeof r.onClearQueue&&r.onClearQueue.call(n,e("#"+o.settings.queueID))})},cancel:function(i,n){this.each(function(){var o=e(this),r=o.data("uploadifive"),l=r.settings;"string"==typeof i&&(isNaN(i)||(fileID="uploadifive-"+e(this).attr("id")+"-file-"+i),i=e("#"+fileID).data("file")),i.skip=!0,r.filesCancelled++,i.uploading&&(r.uploads.current--,i.uploading=!1,i.xhr.abort(),delete i.xhr,t.upload.call(o)),e.inArray("onCancel",l.overrideEvents)<0&&r.removeQueueItem(i,n),"function"==typeof l.onCancel&&l.onCancel.call(o,i)})},upload:function(t,i){this.each(function(){var n=e(this),o=n.data("uploadifive"),r=o.settings;if(t)o.uploadFile.call(n,t);else if(o.uploads.count+o.uploads.current<r.uploadLimit||0==r.uploadLimit){if(!i){o.uploads.attempted=0,o.uploads.successsful=0,o.uploads.errors=0;var l=o.filesToUpload();"function"==typeof r.onUpload&&r.onUpload.call(n,l)}e("#"+r.queueID).find(".uploadifive-queue-item").not(".error, .complete").each(function(){return _file=e(this).data("file"),o.uploads.current>=r.simUploadLimit&&0!==r.simUploadLimit||o.uploads.current>=r.uploadLimit&&0!==r.uploadLimit||o.uploads.count>=r.uploadLimit&&0!==r.uploadLimit?!1:void(r.checkScript?(_file.checking=!0,skipFile=o.checkExists(_file),_file.checking=!1,skipFile||o.uploadFile(_file,!0)):o.uploadFile(_file,!0))}),0==e("#"+r.queueID).find(".uploadifive-queue-item").not(".error, .complete").size()&&o.queueComplete()}else 0==o.uploads.current&&(e.inArray("onError",r.overrideEvents)<0&&o.filesToUpload()>0&&0!=r.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof r.onError&&r.onError.call(n,"UPLOAD_LIMIT_EXCEEDED",o.filesToUpload()))})},destroy:function(){this.each(function(){var i=e(this),n=i.data("uploadifive"),o=n.settings;t.clearQueue.call(i),o.queueID||e("#"+o.queueID).remove(),i.siblings("input").remove(),i.show().insertBefore(n.button),n.button.remove(),"function"==typeof o.onDestroy&&o.onDestroy.call(i)})}};e.fn.uploadifive=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void e.error("The method "+i+" does not exist in $.uploadify"):t.init.apply(this,arguments)}}(jQuery),function(e){var t={init:function(n){return this.each(function(){var o=e(this);o.data("uploadifive",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var r=o.data("uploadifive"),l=r.settings=e.extend({auto:!0,buttonClass:!1,buttonText:"Select Files",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:0,fileType:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,queueSizeLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,uploadScript:"uploadifive.php",width:100},n);if(isNaN(l.fileSizeLimit)){var a=1.024*parseInt(l.fileSizeLimit);l.fileSizeLimit.indexOf("KB")>-1?l.fileSizeLimit=1e3*a:l.fileSizeLimit.indexOf("MB")>-1?l.fileSizeLimit=1e6*a:l.fileSizeLimit.indexOf("GB")>-1&&(l.fileSizeLimit=1e9*a)}else l.fileSizeLimit=1024*l.fileSizeLimit;if(r.inputTemplate=e('<input type="file">').css({"font-size":l.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999}),r.createInput=function(){var i=r.inputTemplate.clone(),n=i.name="input"+r.inputCount++;l.multi&&i.attr("multiple",!0),l.fileType&&i.attr("accept",l.fileType),i.bind("change",function(){r.queue.selected=0,r.queue.replaced=0,r.queue.errors=0,r.queue.queued=0;var i=this.files.length;if(r.queue.selected=i,r.queue.count+i>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(o,"QUEUE_LIMIT_EXCEEDED");else{for(var a=0;i>a;a++)file=this.files[a],r.addQueueItem(file);r.inputs[n]=this,r.createInput()}l.auto&&t.upload.call(o),"function"==typeof l.onSelect&&l.onSelect.call(o,r.queue)}),r.currentInput&&r.currentInput.hide(),r.button.append(i),r.currentInput=i},r.destroyInput=function(t){e(r.inputs[t]).remove(),delete r.inputs[t],r.inputCount--},r.drop=function(i){r.queue.selected=0,r.queue.replaced=0,r.queue.errors=0,r.queue.queued=0;var n=i.dataTransfer,a=n.name="input"+r.inputCount++,u=n.files.length;if(r.queue.selected=u,r.queue.count+u>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(o,"QUEUE_LIMIT_EXCEEDED");else{for(var d=0;u>d;d++)file=n.files[d],r.addQueueItem(file);r.inputs[a]=n}l.auto&&t.upload.call(o),"function"==typeof l.onDrop&&l.onDrop.call(o,n.files,n.files.length),i.preventDefault(),i.stopPropagation()},r.fileExistsInQueue=function(e){for(var t in r.inputs){input=r.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)if(existingFile=input.files[i],existingFile.name==e.name&&!existingFile.complete)return!0}return!1},r.removeExistingFile=function(e){for(var i in r.inputs){input=r.inputs[i],limit=input.files.length;for(var n=0;n<limit;n++)existingFile=input.files[n],existingFile.name!=e.name||existingFile.complete||(r.queue.replaced++,t.cancel.call(o,existingFile,!0))}},r.queueItem=e(0==l.itemTemplate?'<div class="uploadifive-queue-item">                        <a class="close" href="#">X</a>                        <div><span class="filename"></span><span class="fileinfo"></span></div>                        <div class="progress">                            <div class="progress-bar"></div>                        </div>                    </div>':l.itemTemplate),r.addQueueItem=function(i){if(e.inArray("onAddQueueItem",l.overrideEvents)<0){r.removeExistingFile(i),i.queueItem=r.queueItem.clone(),i.queueItem.attr("id",l.id+"-file-"+r.fileID++),i.queueItem.find(".close").bind("click",function(){return t.cancel.call(o,i),!1});var n=i.name;n.length>l.truncateLength&&0!=l.truncateLength&&(n=n.substring(0,l.truncateLength)+"..."),i.queueItem.find(".filename").html(n),i.queueItem.data("file",i),r.queueEl.append(i.queueItem)}"function"==typeof l.onAddQueueItem&&l.onAddQueueItem.call(o,i),i.size>l.fileSizeLimit&&0!=l.fileSizeLimit?r.error("FILE_SIZE_LIMIT_EXCEEDED",i):(r.queue.queued++,r.queue.count++)},r.removeQueueItem=function(t,i,n){n||(n=0);var o=i?0:500;t.queueItem&&(" - Completed"!=t.queueItem.find(".fileinfo").html()&&t.queueItem.find(".fileinfo").html(" - Cancelled"),t.queueItem.find(".progress-bar").width(0),t.queueItem.delay(n).fadeOut(o,function(){e(this).remove()}),delete t.queueItem,r.queue.count--)},r.filesToUpload=function(){var e=0;for(var t in r.inputs){input=r.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)file=input.files[i],file.skip||file.complete||e++}return e},r.checkExists=function(i){if(e.inArray("onCheck",l.overrideEvents)<0){e.ajaxSetup({async:!1});var n=e.extend(l.formData,{filename:i.name});if(e.post(l.checkScript,n,function(e){i.exists=parseInt(e)}),i.exists&&!confirm("A file named "+i.name+" already exists in the upload folder.\nWould you like to replace it?"))return t.cancel.call(o,i),!0}return"function"==typeof l.onCheck&&l.onCheck.call(o,i,i.exists),!1},r.uploadFile=function(t,n){if(!t.skip&&!t.complete&&!t.uploading)if(t.uploading=!0,r.uploads.current++,r.uploads.attempted++,xhr=t.xhr=new XMLHttpRequest,"function"==typeof FormData||"object"==typeof FormData){var a=new FormData;a.append(l.fileObjName,t);for(i in l.formData)a.append(i,l.formData[i]);xhr.open(l.method,l.uploadScript,!0),xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&r.progress(e,t)},!1),xhr.addEventListener("load",function(e){4==this.readyState&&(t.uploading=!1,200==this.status?"Invalid file type."!==t.xhr.responseText?r.uploadComplete(e,t,n):r.error(t.xhr.responseText,t,n):404==this.status?r.error("404_FILE_NOT_FOUND",t,n):403==this.status?r.error("403_FORBIDDEN",t,n):r.error("Unknown Error",t,n))}),xhr.send(a)}else{var u=new FileReader;u.onload=function(i){var a="-------------------------"+(new Date).getTime(),u="--",d="\r\n",s="";

s+=u+a+d,s+='Content-Disposition: form-data; name="'+l.fileObjName+'"',t.name&&(s+='; filename="'+t.name+'"'),s+=d,s+="Content-Type: application/octet-stream"+d+d,s+=i.target.result+d;for(key in l.formData)s+=u+a+d,s+='Content-Disposition: form-data; name="'+key+'"'+d+d,s+=l.formData[key]+d;s+=u+a+u+d,xhr.upload.addEventListener("progress",function(e){r.progress(e,t)},!1),xhr.addEventListener("load",function(e){t.uploading=!1;var i=this.status;404==i?r.error("404_FILE_NOT_FOUND",t,n):"Invalid file type."!=t.xhr.responseText?r.uploadComplete(e,t,n):r.error(t.xhr.responseText,t,n)},!1);var c=l.uploadScript;if("get"==l.method){var f=e(l.formData).param();c+=f}xhr.open(l.method,l.uploadScript,!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+a),"function"==typeof l.onUploadFile&&l.onUploadFile.call(o,t),xhr.sendAsBinary(s)},u.readAsBinaryString(t)}},r.progress=function(t,i){if(e.inArray("onProgress",l.overrideEvents)<0){if(t.lengthComputable)var n=Math.round(t.loaded/t.total*100);i.queueItem.find(".fileinfo").html(" - "+n+"%"),i.queueItem.find(".progress-bar").css("width",n+"%")}"function"==typeof l.onProgress&&l.onProgress.call(o,i,t)},r.error=function(i,n,a){if(e.inArray("onError",l.overrideEvents)<0){switch(i){case"404_FILE_NOT_FOUND":errorMsg="404 Error";break;case"403_FORBIDDEN":errorMsg="403 Forbidden";break;case"FORBIDDEN_FILE_TYPE":errorMsg="Forbidden File Type";break;case"FILE_SIZE_LIMIT_EXCEEDED":errorMsg="File Too Large";break;default:errorMsg="Unknown Error"}n.queueItem.addClass("error").find(".fileinfo").html(" - "+errorMsg),n.queueItem.find(".progress").remove()}"function"==typeof l.onError&&l.onError.call(o,i,n),n.skip=!0,"404_FILE_NOT_FOUND"==i?r.uploads.errors++:r.queue.errors++,a&&t.upload.call(o,null,!0)},r.uploadComplete=function(i,n,a){e.inArray("onUploadComplete",l.overrideEvents)<0&&(n.queueItem.find(".progress-bar").css("width","100%"),n.queueItem.find(".fileinfo").html(" - Completed"),n.queueItem.find(".progress").slideUp(250),n.queueItem.addClass("complete")),"function"==typeof l.onUploadComplete&&l.onUploadComplete.call(o,n,n.xhr.responseText),l.removeCompleted&&setTimeout(function(){t.cancel.call(o,n)},3e3),n.complete=!0,r.uploads.successful++,r.uploads.count++,r.uploads.current--,delete n.xhr,a&&t.upload.call(o,null,!0)},r.queueComplete=function(){"function"==typeof l.onQueueComplete&&l.onQueueComplete.call(o,r.uploads)},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof l.onFallback&&l.onFallback.call(o),!1;if(l.id="uploadifive-"+o.attr("id"),r.button=e('<div id="'+l.id+'" class="uploadifive-button">'+l.buttonText+"</div>"),l.buttonClass&&r.button.addClass(l.buttonClass),r.button.css({height:l.height,"line-height":l.height+"px",overflow:"hidden",position:"relative","text-align":"center",width:l.width}),o.before(r.button).appendTo(r.button).hide(),r.createInput.call(o),l.queueID?r.queueEl=e("#"+l.queueID):(l.queueID=l.id+"-queue",r.queueEl=e('<div id="'+l.queueID+'" class="uploadifive-queue" />'),r.button.after(r.queueEl)),l.dnd){var u=l.dropTarget?e(l.dropTarget):r.queueEl.get(0);u.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("drop",r.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var i=Array.prototype.map.call(e,t),n=new Uint8Array(i);this.send(n.buffer)}),"function"==typeof l.onInit&&l.onInit.call(o)})},debug:function(){return this.each(function(){console.log(e(this).data("uploadifive"))})},clearQueue:function(){this.each(function(){var n=e(this),o=n.data("uploadifive"),r=o.settings;for(var l in o.inputs)for(input=o.inputs[l],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],t.cancel.call(n,file);"function"==typeof r.onClearQueue&&r.onClearQueue.call(n,e("#"+o.settings.queueID))})},cancel:function(i,n){this.each(function(){var o=e(this),r=o.data("uploadifive"),l=r.settings;"string"==typeof i&&(isNaN(i)||(fileID="uploadifive-"+e(this).attr("id")+"-file-"+i),i=e("#"+fileID).data("file")),i.skip=!0,r.filesCancelled++,i.uploading&&(r.uploads.current--,i.uploading=!1,i.xhr.abort(),delete i.xhr,t.upload.call(o)),e.inArray("onCancel",l.overrideEvents)<0&&r.removeQueueItem(i,n),"function"==typeof l.onCancel&&l.onCancel.call(o,i)})},upload:function(t,i){this.each(function(){var n=e(this),o=n.data("uploadifive"),r=o.settings;if(t)o.uploadFile.call(n,t);else if(o.uploads.count+o.uploads.current<r.uploadLimit||0==r.uploadLimit){if(!i){o.uploads.attempted=0,o.uploads.successsful=0,o.uploads.errors=0;var l=o.filesToUpload();"function"==typeof r.onUpload&&r.onUpload.call(n,l)}e("#"+r.queueID).find(".uploadifive-queue-item").not(".error, .complete").each(function(){return _file=e(this).data("file"),o.uploads.current>=r.simUploadLimit&&0!==r.simUploadLimit||o.uploads.current>=r.uploadLimit&&0!==r.uploadLimit||o.uploads.count>=r.uploadLimit&&0!==r.uploadLimit?!1:void(r.checkScript?(_file.checking=!0,skipFile=o.checkExists(_file),_file.checking=!1,skipFile||o.uploadFile(_file,!0)):o.uploadFile(_file,!0))}),0==e("#"+r.queueID).find(".uploadifive-queue-item").not(".error, .complete").size()&&o.queueComplete()}else 0==o.uploads.current&&(e.inArray("onError",r.overrideEvents)<0&&o.filesToUpload()>0&&0!=r.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof r.onError&&r.onError.call(n,"UPLOAD_LIMIT_EXCEEDED",o.filesToUpload()))})},destroy:function(){this.each(function(){var i=e(this),n=i.data("uploadifive"),o=n.settings;t.clearQueue.call(i),o.queueID||e("#"+o.queueID).remove(),i.siblings("input").remove(),i.show().insertBefore(n.button),n.button.remove(),"function"==typeof o.onDestroy&&o.onDestroy.call(i)})}};e.fn.uploadifive=function(i){return t[i]?t[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void e.error("The method "+i+" does not exist in $.uploadify"):t.init.apply(this,arguments)}}(jQuery);