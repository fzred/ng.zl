angular.module("ng.zl",["ng","ngSanitize","ngMaterial","ng.zl.sha256","ng.zl.templates"]),angular.module("ng.zl.pick",["ng.zl"]),angular.module("ng.zl.templates",[]).run(["$templateCache",function(e){e.put("views/apartment.pick.html",'<div>\r\n    <md-autocomplete ng-if="!pickChips" flex required\r\n                     md-selected-item="ngModel"\r\n                     md-search-text="searchText"\r\n                     md-items="item in querySearch(searchText)"\r\n                     md-no-cache="true"\r\n                     md-delay="500"\r\n                     md-item-text="item.apartmentName"\r\n                     md-autoselect="true"\r\n                     ng-disabled="!pickCommunityId"\r\n                     md-floating-label="APARTMENT">\r\n        <md-item-template>\r\n            <span md-highlight-text="searchText">{{item.apartmentName}} </span>\r\n        </md-item-template>\r\n        <md-not-found>\r\n            No matches found\r\n        </md-not-found>\r\n    </md-autocomplete>\r\n\r\n\r\n    <md-chips ng-if="pickChips" ng-model="ngModel" md-autocomplete-snap md-require-match>\r\n        <md-autocomplete\r\n                md-selected-item="selectedItem"\r\n                md-search-text="searchText"\r\n                md-items="item in querySearch(searchText)"\r\n                md-no-cache="true"\r\n                md-delay="500"\r\n                md-item-text="item.apartmentName"\r\n                md-autoselect="true"\r\n                ng-disabled="!pickCommunityId"\r\n                placeholder="APARTMENT">\r\n            <md-item-template>\r\n                <span md-highlight-text="searchText">{{item.apartmentName}}</span>\r\n            </md-item-template>\r\n            <md-not-found>\r\n                No matches found\r\n            </md-not-found>\r\n        </md-autocomplete>\r\n        <md-chip-template>\r\n        <span>\r\n          <strong>{{$chip.apartmentName}}</strong>\r\n        </span>\r\n        </md-chip-template>\r\n    </md-chips>\r\n</div>'),e.put("views/building.pick.html",'<div>\r\n    <md-autocomplete ng-if="!pickChips" flex required\r\n                     md-selected-item="ngModel"\r\n                     md-search-text="searchText"\r\n                     md-items="item in querySearch(searchText)"\r\n                     md-no-cache="true"\r\n                     md-delay="500"\r\n                     md-item-text="item.buildingName"\r\n                     md-autoselect="true"\r\n                     ng-disabled="!pickCommunityId"\r\n                     md-floating-label="BUILDING">\r\n        <md-item-template>\r\n            <span md-highlight-text="searchText">{{item.buildingName}} </span>\r\n        </md-item-template>\r\n        <md-not-found>\r\n            No matches found\r\n        </md-not-found>\r\n    </md-autocomplete>\r\n\r\n\r\n    <md-chips ng-if="pickChips" ng-model="ngModel" md-autocomplete-snap md-require-match>\r\n        <md-autocomplete\r\n                md-selected-item="selectedItem"\r\n                md-search-text="searchText"\r\n                md-items="item in querySearch(searchText)"\r\n                md-no-cache="true"\r\n                md-delay="500"\r\n                md-item-text="item.buildingName"\r\n                md-autoselect="true"\r\n                ng-disabled="!pickCommunityId"\r\n                placeholder="BUILDING">\r\n            <md-item-template>\r\n                <span md-highlight-text="searchText">{{item.buildingName}}</span>\r\n            </md-item-template>\r\n            <md-not-found>\r\n                No matches found\r\n            </md-not-found>\r\n        </md-autocomplete>\r\n        <md-chip-template>\r\n        <span>\r\n          <strong>{{$chip.buildingName}}</strong>\r\n        </span>\r\n        </md-chip-template>\r\n    </md-chips>\r\n</div>'),e.put("views/community.pick.html",'<div>\r\n    <md-autocomplete ng-if="!pickChips" flex required\r\n                     md-selected-item="ngModel"\r\n                     md-search-text="searchText"\r\n                     md-items="item in querySearch(searchText)"\r\n                     md-no-cache="true"\r\n                     md-delay="500"\r\n                     md-item-text="item.name"\r\n                     md-autoselect="true"\r\n                     ng-disabled="!pickCityId"\r\n                     md-floating-label="COMMUNITY">\r\n        <md-item-template>\r\n            <span md-highlight-text="searchText">{{item.name}} </span>\r\n        </md-item-template>\r\n        <md-not-found>\r\n            No matches found\r\n        </md-not-found>\r\n    </md-autocomplete>\r\n\r\n\r\n    <md-chips ng-if="pickChips" ng-model="ngModel" md-autocomplete-snap md-require-match>\r\n        <md-autocomplete\r\n                md-selected-item="selectedItem"\r\n                md-search-text="searchText"\r\n                md-items="item in querySearch(searchText)"\r\n                md-no-cache="true"\r\n                md-delay="500"\r\n                md-item-text="item.name"\r\n                md-autoselect="true"\r\n                ng-disabled="!pickCityId"\r\n                placeholder="COMMUNITY">\r\n            <md-item-template>\r\n                <span md-highlight-text="searchText">{{item.name}}</span>\r\n            </md-item-template>\r\n            <md-not-found>\r\n                No matches found\r\n            </md-not-found>\r\n        </md-autocomplete>\r\n        <md-chip-template>\r\n        <span>\r\n          <strong>{{$chip.name}}</strong>\r\n        </span>\r\n        </md-chip-template>\r\n    </md-chips>\r\n</div>'),e.put("views/grid.edit.html",'<div class="zl-grid-edit" ng-dblclick="onEdit($event)">\r\n    <span ng-bind="gridModel" ng-show="!edit"></span>\r\n    <input type="text" tabindex="-1" ng-model="gridModel" ng-show="edit" ng-blur="cancelEdit($event)" ng-keyup="onKey($event)" zl-focus-on="zlGridEditInput"/>\r\n</div>'),e.put("views/grid.edit.select.html",'<div class="zl-grid-edit" ng-dblclick="onEdit($event)">\r\n    <span ng-bind="gridModel" ng-show="!edit"></span>\r\n    <select tabindex="-1" ng-model="selected" ng-show="edit" zl-focus-on="zlGridEditSelect" ng-blur="cancelEdit($event)" ng-options="value.name for value in selects" ng-change="onChange($event)" ng-keyup="onKey($event)">\r\n    </select>\r\n</div>'),e.put("views/grid.edit.switch.html",'<div class="zl-grid-edit" ng-dblclick="onEdit($event)">\r\n    <span ng-bind="gridModel" ng-show="!edit"></span>\r\n\r\n    <md-switch class="md-primary" tabindex="-1" ng-model="gridModel" aria-label="Switch" zl-focus-on="zlGridEditSwitch" ng-show="edit" ng-blur="cancelEdit($event)" ng-keyup="onKey($event)" ng-change="onChange($event)"></md-switch>\r\n\r\n</div>'),e.put("views/grid.html",'<div class="zl-grid">\r\n    <table class="table table-striped table-hover table-condensed">\r\n        <thead>\r\n        <tr>\r\n            <th ng-if="config.enableSelect" class="zl-grid-select">\r\n                <md-checkbox ng-click="onCheckAll($event)"></md-checkbox>\r\n            </th>\r\n            <th ng-repeat="col in config.columns" ng-bind="col.name"></th>\r\n            <th ng-if="config.actions.length > 0">操作</th>\r\n        </tr>\r\n        </thead>\r\n        <tbody>\r\n        <tr ng-repeat="(rowIndex, data) in config.data">\r\n            <td ng-if="config.enableSelect" class="zl-grid-select">\r\n                <md-checkbox ng-model="data._checked"></md-checkbox>\r\n            </td>\r\n            <td ng-repeat="(columnIndex, col) in config.columns">\r\n                <span ng-if="!col.edit && col.render" style="{{col.style}}">\r\n                    <div zl-compile html="{{col.render(data[col.field])}}"></div>\r\n                </span>\r\n                <span ng-if="!col.edit && !col.render" ng-bind="data[col.field]" style="{{col.style}}"></span>\r\n\r\n                <div ng-if="col.edit && col.editType === \'input\'">\r\n                    <div zl-grid-edit grid-model="data[col.field]" grid-after-edit="onAfterEdit(value, col, data)"></div>\r\n                </div>\r\n                <div ng-if="col.edit && col.editType === \'select\'">\r\n                    <div zl-grid-edit-select grid-model="data[col.field]" grid-edit-type="col.editType" grid-edit-data="col.editData()" grid-after-edit="onAfterEdit(value, col, data)"></div>\r\n                </div>\r\n                <div ng-if="col.edit && col.editType === \'switch\'">\r\n                    <div zl-grid-edit-switch grid-model="data[col.field]" grid-after-edit="onAfterEdit(value, col, data)"></div>\r\n                </div>\r\n            </td>\r\n\r\n            <td ng-if="config.actions.length > 0">\r\n                <md-button ng-repeat="act in config.actions" class="md-raised {{act.className}}" ng-bind="act.html"\r\n                           ng-click="act.action(data, config.data, $event)"></md-button>\r\n            </td>\r\n        </tr>\r\n        </tbody>\r\n    </table>\r\n    <div layout="row">\r\n        <md-button class="md-raised" ng-click="getData()" ng-if="config.next">More</md-button>\r\n        <md-button class="md-raised" ng-if="!config.next" ng-disabled="true">No More</md-button>\r\n        <div flex ng-if="config.enableSelect && config.actions.length > 0">\r\n            <md-button ng-repeat="act in config.actions" class="md-raised {{act.className}}" ng-bind="act.html"\r\n                       ng-click="onBatch(act, $event)"></md-button>\r\n        </div>\r\n    </div>\r\n</div>'),e.put("views/progress.html",'<div class="zl-progress" ng-if="show">\r\n    <md-progress-circular md-mode="indeterminate"></md-progress-circular>\r\n</div>'),e.put("views/prompt.html",'<md-dialog>\r\n    <md-dialog-content>\r\n        <h2 ng-if="config.title">{{config.title}}</h2>\r\n        <p>{{config.content}}</p>\r\n        <md-input-container md-no-float>\r\n            <input ng-model="result" placeholder="">\r\n        </md-input-container>\r\n    </md-dialog-content>\r\n    <div class="md-actions">\r\n        <md-button ng-click="onCancel()" class="md-primary">{{config.cancel | uppercase}}</md-button>\r\n        <md-button ng-click="onOk()" class="md-primary">{{config.ok | lowercase}}</md-button>\r\n    </div>\r\n</md-dialog>'),e.put("views/region.pick.html",'<div>\r\n    <md-autocomplete ng-if="!pickChips" flex required\r\n                     md-selected-item="ngModel"\r\n                     md-search-text="searchText"\r\n                     md-items="item in querySearch(searchText)"\r\n                     md-no-cache="true"\r\n                     md-delay="500"\r\n                     md-item-text="item.name"\r\n                     md-autoselect="true"\r\n                     ng-disabled="(needRegionParent && !regionParent)"\r\n                     md-floating-label="{{name | uppercase}}">\r\n        <md-item-template>\r\n            <span md-highlight-text="searchText">{{item.name}} </span>\r\n            <small md-highlight-text="searchText">({{item.path}})</small>\r\n        </md-item-template>\r\n        <md-not-found>\r\n            No matches found\r\n        </md-not-found>\r\n    </md-autocomplete>\r\n\r\n\r\n    <md-chips ng-if="pickChips" ng-model="ngModel" md-autocomplete-snap md-require-match>\r\n        <md-autocomplete\r\n                md-selected-item="selectedItem"\r\n                md-search-text="searchText"\r\n                md-items="item in querySearch(searchText)"\r\n                md-no-cache="true"\r\n                md-delay="500"\r\n                md-item-text="item.name"\r\n                md-autoselect="true"\r\n                ng-disabled="(needRegionParent && !regionParent)"\r\n                placeholder="{{name | uppercase}}">\r\n            <md-item-template>\r\n                <span md-highlight-text="searchText">{{item.name}}</span>\r\n                <small md-highlight-text="searchText">({{item.path}})</small>\r\n            </md-item-template>\r\n            <md-not-found>\r\n                No matches found\r\n            </md-not-found>\r\n        </md-autocomplete>\r\n        <md-chip-template>\r\n        <span>\r\n          <strong>{{$chip.name}}</strong><small>({{$chip.path}})</small>\r\n        </span>\r\n        </md-chip-template>\r\n    </md-chips>\r\n</div>'),e.put("views/scroll.html",'<div class="zl-scroll">\r\n    <div ng-show="isShow">\r\n    <md-button class="md-fab md-primary md-mini" ng-click="onTop()" ng-if="top">\r\n        t\r\n    </md-button>\r\n\r\n    <md-button class="md-fab md-primary md-mini" ng-click="onBottom()" ng-if="bottom">\r\n        b\r\n    </md-button>\r\n    </div>\r\n</div>'),e.put("views/toast.html",'<div class="zl-toast-container">\r\n    <md-toast ng-repeat="t in list" class="md-default-theme">\r\n        <span ng-bind="t.word"></span>\r\n    </md-toast>\r\n</div>')}]),angular.module("ng.zl.pick").directive("zlApartmentPick",["ZlPickService",function(e){"use strict";return{restrict:"A",replace:!0,scope:{pickCommunityId:"=",pickBuildingName:"=",ngModel:"=",pickChips:"="},templateUrl:"views/apartment.pick.html",controller:["$scope",function(t){function n(e,t){var n=!1;return _.each(t,function(t){t.addressId===e.addressId&&(n=!0)}),n}t.pickChips=t.pickChips||!1,t.searchText=null,t.selectedItem=null,t.querySearch=function(i){return e.getApartmentByWord({buildingName:t.pickBuildingName,communityId:t.pickCommunityId,keyword:i}).then(function(e){return t.pickChips?_.filter(e,function(e){return!n(e,t.ngModel)}):e})}}]}}]),angular.module("ng.zl.pick").directive("zlBuildingPick",["ZlPickService",function(e){"use strict";return{restrict:"A",replace:!0,scope:{pickCommunityId:"=",ngModel:"=",pickChips:"="},templateUrl:"views/building.pick.html",controller:["$scope",function(t){function n(e,t){var n=!1;return _.each(t,function(t){t.buildingName===e.buildingName&&(n=!0)}),n}t.pickChips=t.pickChips||!1,t.searchText=null,t.selectedItem=null,t.querySearch=function(i){return e.getBuildingByWord({communityId:t.pickCommunityId,keyword:i}).then(function(e){return t.pickChips?_.filter(e,function(e){return!n(e,t.ngModel)}):e})}}]}}]),angular.module("ng.zl.pick").directive("zlCommunityPick",["ZlPickService",function(e){"use strict";return{restrict:"A",replace:!0,scope:{pickCityId:"=",ngModel:"=",pickChips:"="},templateUrl:"views/community.pick.html",controller:["$scope",function(t){function n(e,t){var n=!1;return _.each(t,function(t){t.id===e.id&&(n=!0)}),n}t.pickChips=t.pickChips||!1,t.searchText=null,t.selectedItem=null,t.querySearch=function(i){return e.getCommunityByWord({cityId:t.pickCityId,keyword:i}).then(function(e){return t.pickChips?_.filter(e,function(e){return!n(e,t.ngModel)}):e})}}]}}]),angular.module("ng.zl").directive("zlCompile",["$compile",function(e){"use strict";return{replace:!0,restrict:"A",link:function(t,n,i){if(i.html){var r=e(i.html)(t);n.replaceWith(r)}}}}]),angular.module("ng.zl").directive("zlDyCompile",["$compile",function(e){"use strict";return{replace:!0,restrict:"A",link:function(t,n,i){var r,o={$destroy:angular.noop},l=n,a=function(){(r||o).$destroy()};i.$observe("html",function(n){if(n){a(),r=t.$new(!0);var i=e(n)(t);l.replaceWith(i),l=i}t.$on("$destroy",a)})}}}]),angular.module("ng.zl").directive("zlFocusOn",function(){"use strict";return function(e,t,n){return e.$on("zlFocusOn",function(e,i){return i===n.zlFocusOn?t[0].focus():void 0})}}),angular.module("ng.zl.grid",["ng.zl"]).directive("zlGrid",["$zl",function(e){"use strict";return{restrict:"A",replace:!0,scope:{config:"="},templateUrl:"views/grid.html",controller:["$scope",function(t){_.each(t.config.columns,function(e){e.edit&&(e.afterEdit=e.afterEdit||function(){})}),t.config=_.extend({watchReload:!1,enableSelect:!1,columns:null,data:[],next:null,actions:[]},t.config),t.checkAll=!1,t.onCheckAll=function(){t.checkAll=!t.checkAll,_.each(t.config.data,function(e){e._checked=t.checkAll})},t.onBatch=function(e,n){var i=_.filter(t.config.data,function(e){return e._checked});i.length>0&&e.batch(i,t.config.data,n)},t.onAfterEdit=function(t,n,i){if(t.newValue!==t.oldValue){var r=n.afterEdit(i,n,t.newValue,t.oldValue);r&&r.then(function(){e.tips("修改成功")},function(){e.tips("修改失败"),i[n.field]=t.oldValue})}},t.onEditData=function(e){return e.editData()},t.$watch("config.watchReload",function(e){e&&(t.config.data=[],t.getData(),t.config.watchReload=!1)}),t.getData=function(){t.config.getData(t.config.next).then(function(e){_.each(e,function(e,n){"nextPageOffset"!==n&&"nextPageAnchor"!==n&&(t.config.data=t.config.data.concat(e||[]))}),t.config.next=e.nextPageOffset||e.nextPageAnchor})},t.getData()}]}}]).directive("zlGridEdit",["$zlFocusOn","$timeout",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{gridModel:"=",gridAfterEdit:"&"},templateUrl:"views/grid.edit.html",controller:["$scope","$element",function(n,i){n.edit=!1;var r=n.gridModel;i.closest("td").width(i.width()),n.onEdit=function(t){i.addClass("zl-grid-edit-on"),n.edit=!0,e("zlGridEditInput")},n.cancelEdit=function(e){n.edit=!1},n.onKey=function(e){13===e.keyCode?(n.edit=!1,n.gridModel=e.target.value,t(function(){n.gridAfterEdit({value:{newValue:n.gridModel,oldValue:r}})},1)):27===e.keyCode&&(n.edit=!1,n.gridModel=r)}}]}}]).directive("zlGridEditSelect",["$zlFocusOn","$timeout",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{gridModel:"=",gridAfterEdit:"&",gridEditType:"@",gridEditData:"&"},templateUrl:"views/grid.edit.select.html",controller:["$scope","$element",function(n,i){n.edit=!1;var r=n.gridModel;n.selects=[],n.selected=null,n.gridEditData().then(function(e){n.selects=e,n.selected=_.find(e,function(e){return e.value===n.gridModel})}),i.closest("td").width(i.width()),n.onEdit=function(t){i.addClass("zl-grid-edit-on"),n.edit=!0,e("zlGridEditSelect")},n.cancelEdit=function(){n.edit=!1},n.onKey=function(){27===event.keyCode&&(n.edit=!1,n.gridModel=r)},n.onChange=function(e){n.edit=!1,n.gridModel=n.selected.value,t(function(){n.gridAfterEdit({value:{newValue:n.gridModel,oldValue:r}})},1)}}]}}]).directive("zlGridEditSwitch",["$zlFocusOn","$timeout",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{gridModel:"=",gridAfterEdit:"&"},templateUrl:"views/grid.edit.switch.html",controller:["$scope","$element",function(n,i){n.edit=!1,n.gridModel=n.gridModel||!1;var r=n.gridModel;i.closest("td").width(i.width()),n.onEdit=function(t){i.addClass("zl-grid-edit-on"),n.edit=!0,e("zlGridEditSwitch")},n.cancelEdit=function(e){n.edit=!1},n.onKey=function(e){27===e.keyCode&&(n.edit=!1,n.gridModel=r)},n.onChange=function(e){n.edit=!1,t(function(){n.gridAfterEdit({value:{newValue:n.gridModel,oldValue:r}})},1)}}]}}]),angular.module("ng.zl.pick").directive("zlRegionPick",["ZlPickService",function(e){"use strict";return{restrict:"A",replace:!0,scope:{regionParent:"=",ngModel:"=",pickChips:"="},templateUrl:"views/region.pick.html",controller:["$scope","$attrs",function(t,n){function i(e,t){var n=!1;return _.each(t,function(t){t.id===e.id&&(n=!0)}),n}var r="";t.pickChips=t.pickChips||!1,t.needRegionParent=void 0!==n.regionParent,t.name=n.zlRegionPick,"province"===t.name?r="getProvinceByWord":"city"===t.name?r="getCityByWord":"area"===t.name&&(r="getAreaByWord"),t.searchText=null,t.selectedItem=null,t.querySearch=function(n){return e[r]({parentId:t.regionParent&&t.regionParent.id||null,keyword:n}).then(function(e){return t.pickChips?_.filter(e,function(e){return!i(e,t.ngModel)}):e})}}]}}]),angular.module("ng.zl").directive("zlScroll",["$zl","$mdMedia",function(e,t){"use strict";return{restrict:"A",replace:!0,scope:{},templateUrl:"views/scroll.html",controller:["$scope","$element",function(n,i){var r=i.attr("zl-scroll");r.indexOf("scroll-top")>-1&&(n.top=!0),r.indexOf("scroll-bottom")>-1&&(n.bottom=!0),n.onTop=function(){e.scroll.top()},n.onBottom=function(){e.scroll.bottom()},n.isShow=t("gt-md")}]}}]),angular.module("ng.zl").factory("$zlFocusOn",["$rootScope","$timeout",function(e,t){"use strict";return function(n){return t(function(){return e.$broadcast("zlFocusOn",n)})}}]),angular.module("ng.zl").factory("$zl",["$mdDialog","$mdToast","$compile","$rootScope","$templateRequest","$timeout","$zlSha256","$q",function(e,t,n,i,r,o,l,a){"use strict";var u=$(document.body),d=function(t,n,i){var r=e.alert().parent(u).title(n).content(t).ok("ok");return i&&(r=r.targetEvent(i)),e.show(r)},c=function(t,n,i,r,o){r=r||"ok",o=o||"cancel";var l=e.confirm().parent(u).title(n).content(t).ok(r).cancel(o);return i&&(l=l.targetEvent(i)),e.show(l)},s=function(t,n,i,r,o){return r=r||"ok",o=o||"cancel",e.show({targetEvent:i,templateUrl:"views/prompt.html",controller:["$scope","config",function(t,n){t.config=n,t.result="",t.onCancel=function(){e.cancel()},t.onOk=function(){e.hide(t.result)}}],locals:{config:{title:n,content:t,ok:r,cancel:o}}})},p=null,m=i.$new();m.list=[];var f=function(e,t,i){var l=a.defer();p||(p=!0,r("views/toast.html").then(function(e){p=$(e),$(document.body).append(p),n(p)(m)}));var u=+new Date;return m.list.unshift({word:e,_key_:u}),o(function(){m.list.splice(m.list.indexOf(_.find(m.list,function(e){return e._key_===u})),1),l.resolve({})},i||4e3),l.promise},h=null,g=i.$new();g.show=!1;var v={start:function(){h||(h=!0,r("views/progress.html").then(function(e){h=$(e),$(document.body).append(h),n(h)(g)})),g.show=!0},done:function(){g.show=!1}},y={set:function(e){var t=$(".site-content")[0];t.scrollTop=e},top:function(){y.set(0)},bottom:function(){y.set($(document.body).height())},page:function(){y.set(document.body.scrollTop+document.documentElement.clientHeight)}},x=function(e,t){var n=e;return arguments.length<2?n:n=n.replace(/\{([\d\w\.]+)\}/g,function(e){var n=arguments[1].split("."),i=null;return _.each(n,function(e,n){i=n?i[e]:t[e]}),i})},E=null,b={set:function(e){E=e},get:function(){return E}},I={alert:d,confirm:c,prompt:s,tips:f,progress:v,scroll:y,format:x,sha256:l,userInfo:b};return window.ZL=I,I}]),angular.module("ng.zl.pick").factory("ZlPickService",["$q","$log","$zl",function(e,t,n){"use strict";function i(t,n){var i=e.defer();return $.ajax({url:"/"===t[0]?t:o+t,type:"post",data:n,dataType:"json",success:function(e){i.resolve(e)},error:function(){i.reject("服务器错误")}}),r(i.promise)}function r(t){return t.then(function(t){return 0===t.errorCode||200===t.errorCode?t.response||{}:e.reject((t.errorDescription||"未知错误")+"  errorCode:"+t.errorCode+"  version:"+t.version)},function(t){return e.reject(t)}).then(function(e){return e},function(t){return n.tips(t),e.reject(t)})}var o="/admin/",l={};l.getProvinceByWord=function(e){return i("/region/listRegionByKeyword",_.extend(e,{scope:1}))},l.getCityByWord=function(e){return i("/region/listRegionByKeyword",_.extend(e,{scope:2}))},l.getAreaByWord=function(e){return i("/region/listRegionByKeyword",_.extend(e,{scope:3}))},l.getCommunityByWord=function(e){return i("/address/searchCommunities",e)},l.getBuildingByWord=function(e){return i("/address/listBuildingsByKeyword",e)},l.getApartmentByWord=function(e){return i("/address/listApartmentsByKeyword",e)};var a={};return _.each(l,function(e,t){a[t]=function(t){return e.apply(this,[angular.copy(t)]).then(function(e){return angular.copy(e)})}}),a}]),angular.module("ng.zl.sha256",[]).factory("$zlSha256",function(){"use strict";var e=function(e){function t(e,t){return t>>>e|t<<32-e}function n(e,t,n){return e&t^~e&n}function i(e,t,n){return e&t^e&n^t&n}function r(e){return t(2,e)^t(13,e)^t(22,e)}function o(e){return t(6,e)^t(11,e)^t(25,e)}function l(e){return t(7,e)^t(18,e)^e>>>3}function a(e){return t(17,e)^t(19,e)^e>>>10}function u(e,t){return e[15&t]+=a(e[t+14&15])+e[t+9&15]+l(e[t+1&15])}function d(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function c(){g=new Array(8),v=new Array(2),y=new Array(64),v[0]=v[1]=0,g[0]=1779033703,g[1]=3144134277,g[2]=1013904242,g[3]=2773480762,g[4]=1359893119,g[5]=2600822924,g[6]=528734635,g[7]=1541459225}function s(){var e,t,l,a,c,s,p,m,f,h,v=new Array(16);e=g[0],t=g[1],l=g[2],a=g[3],c=g[4],s=g[5],p=g[6],m=g[7];for(var E=0;16>E;E++)v[E]=y[(E<<2)+3]|y[(E<<2)+2]<<8|y[(E<<2)+1]<<16|y[E<<2]<<24;for(var b=0;64>b;b++)f=m+o(c)+n(c,s,p)+x[b],f+=16>b?v[b]:u(v,b),h=r(e)+i(e,t,l),m=p,p=s,s=c,c=d(a,f),a=l,l=t,t=e,e=d(f,h);g[0]+=e,g[1]+=t,g[2]+=l,g[3]+=a,g[4]+=c,g[5]+=s,g[6]+=p,g[7]+=m}function p(e,t){var n,i,r=0;i=v[0]>>3&63;var o=63&t;for((v[0]+=t<<3)<t<<3&&v[1]++,v[1]+=t>>29,n=0;t>n+63;n+=64){for(var l=i;64>l;l++)y[l]=e.charCodeAt(r++);s(),i=0}for(var l=0;o>l;l++)y[l]=e.charCodeAt(r++)}function m(){var e=v[0]>>3&63;if(y[e++]=128,56>=e)for(var t=e;56>t;t++)y[t]=0;else{for(var t=e;64>t;t++)y[t]=0;s();for(var t=0;56>t;t++)y[t]=0}y[56]=v[1]>>>24&255,y[57]=v[1]>>>16&255,y[58]=v[1]>>>8&255,y[59]=255&v[1],y[60]=v[0]>>>24&255,y[61]=v[0]>>>16&255,y[62]=v[0]>>>8&255,y[63]=255&v[0],s()}function f(){for(var e=new String,t=0;8>t;t++)for(var n=28;n>=0;n-=4)e+=E.charAt(g[t]>>>n&15);return e}function h(e){return c(),p(e,e.length),m(),f()}var g,v,y,x=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),E="0123456789abcdef";return h(e)};return e}),angular.module("ng.zl.uploader",[]).service("$zlUploader",["$log","$q",function(e,t){"use strict";var n=function(e,n){var i=t.defer(),r=$(e),o=$.extend({height:37,buttonText:"上传",buttonClass:"zl-btn-upload",removeCompleted:!0},n);if(""===r[0].id)throw"container id ?";if(o.url)throw" url ?";return r.uploadifive(o),i.promise},i=function(e,t){return t=$.extend({fileObjName:"attachment",buttonText:"上传文件",multi:!1},t),n(e,t)},r=function(e,t){return t=$.extend({fileObjName:"resFiles",buttonText:"上传图片",multi:!1},t),n(e,t)};return{fileUpload:i,imgUpload:r}}]),function(e){var t={init:function(n){return this.each(function(){var r=e(this);r.data("uploadifive",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var o=r.data("uploadifive"),l=o.settings=e.extend({auto:!0,buttonClass:!1,buttonText:"Select Files",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:0,fileType:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,queueSizeLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,uploadScript:"uploadifive.php",width:100},n);if(isNaN(l.fileSizeLimit)){var a=1.024*parseInt(l.fileSizeLimit);l.fileSizeLimit.indexOf("KB")>-1?l.fileSizeLimit=1e3*a:l.fileSizeLimit.indexOf("MB")>-1?l.fileSizeLimit=1e6*a:l.fileSizeLimit.indexOf("GB")>-1&&(l.fileSizeLimit=1e9*a)}else l.fileSizeLimit=1024*l.fileSizeLimit;if(o.inputTemplate=e('<input type="file">').css({"font-size":l.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999}),o.createInput=function(){var n=o.inputTemplate.clone(),i=n.name="input"+o.inputCount++;l.multi&&n.attr("multiple",!0),l.fileType&&n.attr("accept",l.fileType),n.bind("change",function(){o.queue.selected=0,o.queue.replaced=0,o.queue.errors=0,o.queue.queued=0;var n=this.files.length;if(o.queue.selected=n,o.queue.count+n>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(r,"QUEUE_LIMIT_EXCEEDED");else{for(var a=0;n>a;a++)file=this.files[a],o.addQueueItem(file);o.inputs[i]=this,o.createInput()}l.auto&&t.upload.call(r),"function"==typeof l.onSelect&&l.onSelect.call(r,o.queue)}),o.currentInput&&o.currentInput.hide(),o.button.append(n),o.currentInput=n},o.destroyInput=function(t){e(o.inputs[t]).remove(),delete o.inputs[t],o.inputCount--},o.drop=function(n){o.queue.selected=0,o.queue.replaced=0,o.queue.errors=0,o.queue.queued=0;var i=n.dataTransfer,a=i.name="input"+o.inputCount++,u=i.files.length;if(o.queue.selected=u,o.queue.count+u>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(r,"QUEUE_LIMIT_EXCEEDED");else{for(var d=0;u>d;d++)file=i.files[d],o.addQueueItem(file);o.inputs[a]=i}l.auto&&t.upload.call(r),"function"==typeof l.onDrop&&l.onDrop.call(r,i.files,i.files.length),n.preventDefault(),n.stopPropagation()},o.fileExistsInQueue=function(e){for(var t in o.inputs){input=o.inputs[t],limit=input.files.length;for(var n=0;n<limit;n++)if(existingFile=input.files[n],existingFile.name==e.name&&!existingFile.complete)return!0}return!1},o.removeExistingFile=function(e){for(var n in o.inputs){input=o.inputs[n],limit=input.files.length;for(var i=0;i<limit;i++)existingFile=input.files[i],existingFile.name!=e.name||existingFile.complete||(o.queue.replaced++,t.cancel.call(r,existingFile,!0))}},o.queueItem=e(0==l.itemTemplate?'<div class="uploadifive-queue-item">\r\n                        <a class="close" href="#">X</a>\r\n                        <div><span class="filename"></span><span class="fileinfo"></span></div>\r\n                        <div class="progress">\r\n                            <div class="progress-bar"></div>\r\n                        </div>\r\n                    </div>':l.itemTemplate),o.addQueueItem=function(n){if(e.inArray("onAddQueueItem",l.overrideEvents)<0){o.removeExistingFile(n),n.queueItem=o.queueItem.clone(),n.queueItem.attr("id",l.id+"-file-"+o.fileID++),n.queueItem.find(".close").bind("click",function(){return t.cancel.call(r,n),!1});var i=n.name;i.length>l.truncateLength&&0!=l.truncateLength&&(i=i.substring(0,l.truncateLength)+"..."),n.queueItem.find(".filename").html(i),n.queueItem.data("file",n),o.queueEl.append(n.queueItem)}"function"==typeof l.onAddQueueItem&&l.onAddQueueItem.call(r,n),n.size>l.fileSizeLimit&&0!=l.fileSizeLimit?o.error("FILE_SIZE_LIMIT_EXCEEDED",n):(o.queue.queued++,o.queue.count++)},o.removeQueueItem=function(t,n,i){i||(i=0);var r=n?0:500;t.queueItem&&(" - Completed"!=t.queueItem.find(".fileinfo").html()&&t.queueItem.find(".fileinfo").html(" - Cancelled"),t.queueItem.find(".progress-bar").width(0),t.queueItem.delay(i).fadeOut(r,function(){e(this).remove()}),delete t.queueItem,o.queue.count--)},o.filesToUpload=function(){var e=0;for(var t in o.inputs){input=o.inputs[t],limit=input.files.length;for(var n=0;n<limit;n++)file=input.files[n],file.skip||file.complete||e++}return e},o.checkExists=function(n){if(e.inArray("onCheck",l.overrideEvents)<0){e.ajaxSetup({async:!1});var i=e.extend(l.formData,{filename:n.name});if(e.post(l.checkScript,i,function(e){n.exists=parseInt(e)}),n.exists&&!confirm("A file named "+n.name+" already exists in the upload folder.\nWould you like to replace it?"))return t.cancel.call(r,n),!0}return"function"==typeof l.onCheck&&l.onCheck.call(r,n,n.exists),!1},o.uploadFile=function(t,n){if(!t.skip&&!t.complete&&!t.uploading)if(t.uploading=!0,o.uploads.current++,o.uploads.attempted++,xhr=t.xhr=new XMLHttpRequest,"function"==typeof FormData||"object"==typeof FormData){var a=new FormData;a.append(l.fileObjName,t);for(i in l.formData)a.append(i,l.formData[i]);xhr.open(l.method,l.uploadScript,!0),xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&o.progress(e,t)},!1),xhr.addEventListener("load",function(e){4==this.readyState&&(t.uploading=!1,200==this.status?"Invalid file type."!==t.xhr.responseText?o.uploadComplete(e,t,n):o.error(t.xhr.responseText,t,n):404==this.status?o.error("404_FILE_NOT_FOUND",t,n):403==this.status?o.error("403_FORBIDDEN",t,n):o.error("Unknown Error",t,n));

}),xhr.send(a)}else{var u=new FileReader;u.onload=function(i){var a="-------------------------"+(new Date).getTime(),u="--",d="\r\n",c="";c+=u+a+d,c+='Content-Disposition: form-data; name="'+l.fileObjName+'"',t.name&&(c+='; filename="'+t.name+'"'),c+=d,c+="Content-Type: application/octet-stream"+d+d,c+=i.target.result+d;for(key in l.formData)c+=u+a+d,c+='Content-Disposition: form-data; name="'+key+'"'+d+d,c+=l.formData[key]+d;c+=u+a+u+d,xhr.upload.addEventListener("progress",function(e){o.progress(e,t)},!1),xhr.addEventListener("load",function(e){t.uploading=!1;var i=this.status;404==i?o.error("404_FILE_NOT_FOUND",t,n):"Invalid file type."!=t.xhr.responseText?o.uploadComplete(e,t,n):o.error(t.xhr.responseText,t,n)},!1);var s=l.uploadScript;if("get"==l.method){var p=e(l.formData).param();s+=p}xhr.open(l.method,l.uploadScript,!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+a),"function"==typeof l.onUploadFile&&l.onUploadFile.call(r,t),xhr.sendAsBinary(c)},u.readAsBinaryString(t)}},o.progress=function(t,n){if(e.inArray("onProgress",l.overrideEvents)<0){if(t.lengthComputable)var i=Math.round(t.loaded/t.total*100);n.queueItem.find(".fileinfo").html(" - "+i+"%"),n.queueItem.find(".progress-bar").css("width",i+"%")}"function"==typeof l.onProgress&&l.onProgress.call(r,n,t)},o.error=function(n,i,a){if(e.inArray("onError",l.overrideEvents)<0){switch(n){case"404_FILE_NOT_FOUND":errorMsg="404 Error";break;case"403_FORBIDDEN":errorMsg="403 Forbidden";break;case"FORBIDDEN_FILE_TYPE":errorMsg="Forbidden File Type";break;case"FILE_SIZE_LIMIT_EXCEEDED":errorMsg="File Too Large";break;default:errorMsg="Unknown Error"}i.queueItem.addClass("error").find(".fileinfo").html(" - "+errorMsg),i.queueItem.find(".progress").remove()}"function"==typeof l.onError&&l.onError.call(r,n,i),i.skip=!0,"404_FILE_NOT_FOUND"==n?o.uploads.errors++:o.queue.errors++,a&&t.upload.call(r,null,!0)},o.uploadComplete=function(n,i,a){e.inArray("onUploadComplete",l.overrideEvents)<0&&(i.queueItem.find(".progress-bar").css("width","100%"),i.queueItem.find(".fileinfo").html(" - Completed"),i.queueItem.find(".progress").slideUp(250),i.queueItem.addClass("complete")),"function"==typeof l.onUploadComplete&&l.onUploadComplete.call(r,i,i.xhr.responseText),l.removeCompleted&&setTimeout(function(){t.cancel.call(r,i)},3e3),i.complete=!0,o.uploads.successful++,o.uploads.count++,o.uploads.current--,delete i.xhr,a&&t.upload.call(r,null,!0)},o.queueComplete=function(){"function"==typeof l.onQueueComplete&&l.onQueueComplete.call(r,o.uploads)},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof l.onFallback&&l.onFallback.call(r),!1;if(l.id="uploadifive-"+r.attr("id"),o.button=e('<div id="'+l.id+'" class="uploadifive-button">'+l.buttonText+"</div>"),l.buttonClass&&o.button.addClass(l.buttonClass),o.button.css({height:l.height,"line-height":l.height+"px",overflow:"hidden",position:"relative","text-align":"center",width:l.width}),r.before(o.button).appendTo(o.button).hide(),o.createInput.call(r),l.queueID?o.queueEl=e("#"+l.queueID):(l.queueID=l.id+"-queue",o.queueEl=e('<div id="'+l.queueID+'" class="uploadifive-queue" />'),o.button.after(o.queueEl)),l.dnd){var u=l.dropTarget?e(l.dropTarget):o.queueEl.get(0);u.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("drop",o.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var n=Array.prototype.map.call(e,t),i=new Uint8Array(n);this.send(i.buffer)}),"function"==typeof l.onInit&&l.onInit.call(r)})},debug:function(){return this.each(function(){console.log(e(this).data("uploadifive"))})},clearQueue:function(){this.each(function(){var n=e(this),r=n.data("uploadifive"),o=r.settings;for(var l in r.inputs)for(input=r.inputs[l],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],t.cancel.call(n,file);"function"==typeof o.onClearQueue&&o.onClearQueue.call(n,e("#"+r.settings.queueID))})},cancel:function(n,i){this.each(function(){var r=e(this),o=r.data("uploadifive"),l=o.settings;"string"==typeof n&&(isNaN(n)||(fileID="uploadifive-"+e(this).attr("id")+"-file-"+n),n=e("#"+fileID).data("file")),n.skip=!0,o.filesCancelled++,n.uploading&&(o.uploads.current--,n.uploading=!1,n.xhr.abort(),delete n.xhr,t.upload.call(r)),e.inArray("onCancel",l.overrideEvents)<0&&o.removeQueueItem(n,i),"function"==typeof l.onCancel&&l.onCancel.call(r,n)})},upload:function(t,n){this.each(function(){var i=e(this),r=i.data("uploadifive"),o=r.settings;if(t)r.uploadFile.call(i,t);else if(r.uploads.count+r.uploads.current<o.uploadLimit||0==o.uploadLimit){if(!n){r.uploads.attempted=0,r.uploads.successsful=0,r.uploads.errors=0;var l=r.filesToUpload();"function"==typeof o.onUpload&&o.onUpload.call(i,l)}e("#"+o.queueID).find(".uploadifive-queue-item").not(".error, .complete").each(function(){return _file=e(this).data("file"),r.uploads.current>=o.simUploadLimit&&0!==o.simUploadLimit||r.uploads.current>=o.uploadLimit&&0!==o.uploadLimit||r.uploads.count>=o.uploadLimit&&0!==o.uploadLimit?!1:void(o.checkScript?(_file.checking=!0,skipFile=r.checkExists(_file),_file.checking=!1,skipFile||r.uploadFile(_file,!0)):r.uploadFile(_file,!0))}),0==e("#"+o.queueID).find(".uploadifive-queue-item").not(".error, .complete").size()&&r.queueComplete()}else 0==r.uploads.current&&(e.inArray("onError",o.overrideEvents)<0&&r.filesToUpload()>0&&0!=o.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof o.onError&&o.onError.call(i,"UPLOAD_LIMIT_EXCEEDED",r.filesToUpload()))})},destroy:function(){this.each(function(){var n=e(this),i=n.data("uploadifive"),r=i.settings;t.clearQueue.call(n),r.queueID||e("#"+r.queueID).remove(),n.siblings("input").remove(),n.show().insertBefore(i.button),i.button.remove(),"function"==typeof r.onDestroy&&r.onDestroy.call(n)})}};e.fn.uploadifive=function(n){return t[n]?t[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void e.error("The method "+n+" does not exist in $.uploadify"):t.init.apply(this,arguments)}}(jQuery),function(e){var t={init:function(n){return this.each(function(){var r=e(this);r.data("uploadifive",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var o=r.data("uploadifive"),l=o.settings=e.extend({auto:!0,buttonClass:!1,buttonText:"Select Files",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:0,fileType:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,queueSizeLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,uploadScript:"uploadifive.php",width:100},n);if(isNaN(l.fileSizeLimit)){var a=1.024*parseInt(l.fileSizeLimit);l.fileSizeLimit.indexOf("KB")>-1?l.fileSizeLimit=1e3*a:l.fileSizeLimit.indexOf("MB")>-1?l.fileSizeLimit=1e6*a:l.fileSizeLimit.indexOf("GB")>-1&&(l.fileSizeLimit=1e9*a)}else l.fileSizeLimit=1024*l.fileSizeLimit;if(o.inputTemplate=e('<input type="file">').css({"font-size":l.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999}),o.createInput=function(){var n=o.inputTemplate.clone(),i=n.name="input"+o.inputCount++;l.multi&&n.attr("multiple",!0),l.fileType&&n.attr("accept",l.fileType),n.bind("change",function(){o.queue.selected=0,o.queue.replaced=0,o.queue.errors=0,o.queue.queued=0;var n=this.files.length;if(o.queue.selected=n,o.queue.count+n>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(r,"QUEUE_LIMIT_EXCEEDED");else{for(var a=0;n>a;a++)file=this.files[a],o.addQueueItem(file);o.inputs[i]=this,o.createInput()}l.auto&&t.upload.call(r),"function"==typeof l.onSelect&&l.onSelect.call(r,o.queue)}),o.currentInput&&o.currentInput.hide(),o.button.append(n),o.currentInput=n},o.destroyInput=function(t){e(o.inputs[t]).remove(),delete o.inputs[t],o.inputCount--},o.drop=function(n){o.queue.selected=0,o.queue.replaced=0,o.queue.errors=0,o.queue.queued=0;var i=n.dataTransfer,a=i.name="input"+o.inputCount++,u=i.files.length;if(o.queue.selected=u,o.queue.count+u>l.queueSizeLimit&&0!==l.queueSizeLimit)e.inArray("onError",l.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+l.queueSizeLimit+").  Please select fewer files."),"function"==typeof l.onError&&l.onError.call(r,"QUEUE_LIMIT_EXCEEDED");else{for(var d=0;u>d;d++)file=i.files[d],o.addQueueItem(file);o.inputs[a]=i}l.auto&&t.upload.call(r),"function"==typeof l.onDrop&&l.onDrop.call(r,i.files,i.files.length),n.preventDefault(),n.stopPropagation()},o.fileExistsInQueue=function(e){for(var t in o.inputs){input=o.inputs[t],limit=input.files.length;for(var n=0;n<limit;n++)if(existingFile=input.files[n],existingFile.name==e.name&&!existingFile.complete)return!0}return!1},o.removeExistingFile=function(e){for(var n in o.inputs){input=o.inputs[n],limit=input.files.length;for(var i=0;i<limit;i++)existingFile=input.files[i],existingFile.name!=e.name||existingFile.complete||(o.queue.replaced++,t.cancel.call(r,existingFile,!0))}},o.queueItem=e(0==l.itemTemplate?'<div class="uploadifive-queue-item">                        <a class="close" href="#">X</a>                        <div><span class="filename"></span><span class="fileinfo"></span></div>                        <div class="progress">                            <div class="progress-bar"></div>                        </div>                    </div>':l.itemTemplate),o.addQueueItem=function(n){if(e.inArray("onAddQueueItem",l.overrideEvents)<0){o.removeExistingFile(n),n.queueItem=o.queueItem.clone(),n.queueItem.attr("id",l.id+"-file-"+o.fileID++),n.queueItem.find(".close").bind("click",function(){return t.cancel.call(r,n),!1});var i=n.name;i.length>l.truncateLength&&0!=l.truncateLength&&(i=i.substring(0,l.truncateLength)+"..."),n.queueItem.find(".filename").html(i),n.queueItem.data("file",n),o.queueEl.append(n.queueItem)}"function"==typeof l.onAddQueueItem&&l.onAddQueueItem.call(r,n),n.size>l.fileSizeLimit&&0!=l.fileSizeLimit?o.error("FILE_SIZE_LIMIT_EXCEEDED",n):(o.queue.queued++,o.queue.count++)},o.removeQueueItem=function(t,n,i){i||(i=0);var r=n?0:500;t.queueItem&&(" - Completed"!=t.queueItem.find(".fileinfo").html()&&t.queueItem.find(".fileinfo").html(" - Cancelled"),t.queueItem.find(".progress-bar").width(0),t.queueItem.delay(i).fadeOut(r,function(){e(this).remove()}),delete t.queueItem,o.queue.count--)},o.filesToUpload=function(){var e=0;for(var t in o.inputs){input=o.inputs[t],limit=input.files.length;for(var n=0;n<limit;n++)file=input.files[n],file.skip||file.complete||e++}return e},o.checkExists=function(n){if(e.inArray("onCheck",l.overrideEvents)<0){e.ajaxSetup({async:!1});var i=e.extend(l.formData,{filename:n.name});if(e.post(l.checkScript,i,function(e){n.exists=parseInt(e)}),n.exists&&!confirm("A file named "+n.name+" already exists in the upload folder.\nWould you like to replace it?"))return t.cancel.call(r,n),!0}return"function"==typeof l.onCheck&&l.onCheck.call(r,n,n.exists),!1},o.uploadFile=function(t,n){if(!t.skip&&!t.complete&&!t.uploading)if(t.uploading=!0,o.uploads.current++,o.uploads.attempted++,xhr=t.xhr=new XMLHttpRequest,"function"==typeof FormData||"object"==typeof FormData){var a=new FormData;a.append(l.fileObjName,t);for(i in l.formData)a.append(i,l.formData[i]);xhr.open(l.method,l.uploadScript,!0),xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&o.progress(e,t)},!1),xhr.addEventListener("load",function(e){4==this.readyState&&(t.uploading=!1,200==this.status?"Invalid file type."!==t.xhr.responseText?o.uploadComplete(e,t,n):o.error(t.xhr.responseText,t,n):404==this.status?o.error("404_FILE_NOT_FOUND",t,n):403==this.status?o.error("403_FORBIDDEN",t,n):o.error("Unknown Error",t,n))}),xhr.send(a)}else{var u=new FileReader;u.onload=function(i){var a="-------------------------"+(new Date).getTime(),u="--",d="\r\n",c="";c+=u+a+d,c+='Content-Disposition: form-data; name="'+l.fileObjName+'"',t.name&&(c+='; filename="'+t.name+'"'),c+=d,c+="Content-Type: application/octet-stream"+d+d,c+=i.target.result+d;for(key in l.formData)c+=u+a+d,c+='Content-Disposition: form-data; name="'+key+'"'+d+d,c+=l.formData[key]+d;c+=u+a+u+d,xhr.upload.addEventListener("progress",function(e){o.progress(e,t)},!1),xhr.addEventListener("load",function(e){t.uploading=!1;var i=this.status;404==i?o.error("404_FILE_NOT_FOUND",t,n):"Invalid file type."!=t.xhr.responseText?o.uploadComplete(e,t,n):o.error(t.xhr.responseText,t,n)},!1);var s=l.uploadScript;if("get"==l.method){var p=e(l.formData).param();s+=p}xhr.open(l.method,l.uploadScript,!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+a),"function"==typeof l.onUploadFile&&l.onUploadFile.call(r,t),xhr.sendAsBinary(c)},u.readAsBinaryString(t)}},o.progress=function(t,n){if(e.inArray("onProgress",l.overrideEvents)<0){if(t.lengthComputable)var i=Math.round(t.loaded/t.total*100);n.queueItem.find(".fileinfo").html(" - "+i+"%"),n.queueItem.find(".progress-bar").css("width",i+"%")}"function"==typeof l.onProgress&&l.onProgress.call(r,n,t)},o.error=function(n,i,a){if(e.inArray("onError",l.overrideEvents)<0){switch(n){case"404_FILE_NOT_FOUND":errorMsg="404 Error";break;case"403_FORBIDDEN":errorMsg="403 Forbidden";break;case"FORBIDDEN_FILE_TYPE":errorMsg="Forbidden File Type";break;case"FILE_SIZE_LIMIT_EXCEEDED":errorMsg="File Too Large";break;default:errorMsg="Unknown Error"}i.queueItem.addClass("error").find(".fileinfo").html(" - "+errorMsg),i.queueItem.find(".progress").remove()}"function"==typeof l.onError&&l.onError.call(r,n,i),i.skip=!0,"404_FILE_NOT_FOUND"==n?o.uploads.errors++:o.queue.errors++,a&&t.upload.call(r,null,!0)},o.uploadComplete=function(n,i,a){e.inArray("onUploadComplete",l.overrideEvents)<0&&(i.queueItem.find(".progress-bar").css("width","100%"),i.queueItem.find(".fileinfo").html(" - Completed"),i.queueItem.find(".progress").slideUp(250),i.queueItem.addClass("complete")),"function"==typeof l.onUploadComplete&&l.onUploadComplete.call(r,i,i.xhr.responseText),l.removeCompleted&&setTimeout(function(){t.cancel.call(r,i)},3e3),i.complete=!0,o.uploads.successful++,o.uploads.count++,o.uploads.current--,delete i.xhr,a&&t.upload.call(r,null,!0)},o.queueComplete=function(){"function"==typeof l.onQueueComplete&&l.onQueueComplete.call(r,o.uploads)},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof l.onFallback&&l.onFallback.call(r),!1;if(l.id="uploadifive-"+r.attr("id"),o.button=e('<div id="'+l.id+'" class="uploadifive-button">'+l.buttonText+"</div>"),l.buttonClass&&o.button.addClass(l.buttonClass),o.button.css({height:l.height,"line-height":l.height+"px",overflow:"hidden",position:"relative","text-align":"center",width:l.width}),r.before(o.button).appendTo(o.button).hide(),o.createInput.call(r),l.queueID?o.queueEl=e("#"+l.queueID):(l.queueID=l.id+"-queue",o.queueEl=e('<div id="'+l.queueID+'" class="uploadifive-queue" />'),o.button.after(o.queueEl)),l.dnd){var u=l.dropTarget?e(l.dropTarget):o.queueEl.get(0);u.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),u.addEventListener("drop",o.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){function t(e){return 255&e.charCodeAt(0)}var n=Array.prototype.map.call(e,t),i=new Uint8Array(n);this.send(i.buffer)}),"function"==typeof l.onInit&&l.onInit.call(r)})},debug:function(){return this.each(function(){console.log(e(this).data("uploadifive"))})},clearQueue:function(){this.each(function(){var n=e(this),r=n.data("uploadifive"),o=r.settings;for(var l in r.inputs)for(input=r.inputs[l],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],t.cancel.call(n,file);"function"==typeof o.onClearQueue&&o.onClearQueue.call(n,e("#"+r.settings.queueID))})},cancel:function(n,i){this.each(function(){var r=e(this),o=r.data("uploadifive"),l=o.settings;"string"==typeof n&&(isNaN(n)||(fileID="uploadifive-"+e(this).attr("id")+"-file-"+n),n=e("#"+fileID).data("file")),n.skip=!0,o.filesCancelled++,n.uploading&&(o.uploads.current--,n.uploading=!1,n.xhr.abort(),delete n.xhr,t.upload.call(r)),e.inArray("onCancel",l.overrideEvents)<0&&o.removeQueueItem(n,i),"function"==typeof l.onCancel&&l.onCancel.call(r,n)})},upload:function(t,n){this.each(function(){var i=e(this),r=i.data("uploadifive"),o=r.settings;if(t)r.uploadFile.call(i,t);else if(r.uploads.count+r.uploads.current<o.uploadLimit||0==o.uploadLimit){if(!n){r.uploads.attempted=0,r.uploads.successsful=0,r.uploads.errors=0;var l=r.filesToUpload();"function"==typeof o.onUpload&&o.onUpload.call(i,l)}e("#"+o.queueID).find(".uploadifive-queue-item").not(".error, .complete").each(function(){return _file=e(this).data("file"),r.uploads.current>=o.simUploadLimit&&0!==o.simUploadLimit||r.uploads.current>=o.uploadLimit&&0!==o.uploadLimit||r.uploads.count>=o.uploadLimit&&0!==o.uploadLimit?!1:void(o.checkScript?(_file.checking=!0,skipFile=r.checkExists(_file),_file.checking=!1,skipFile||r.uploadFile(_file,!0)):r.uploadFile(_file,!0))}),0==e("#"+o.queueID).find(".uploadifive-queue-item").not(".error, .complete").size()&&r.queueComplete()}else 0==r.uploads.current&&(e.inArray("onError",o.overrideEvents)<0&&r.filesToUpload()>0&&0!=o.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof o.onError&&o.onError.call(i,"UPLOAD_LIMIT_EXCEEDED",r.filesToUpload()))})},destroy:function(){this.each(function(){var n=e(this),i=n.data("uploadifive"),r=i.settings;t.clearQueue.call(n),r.queueID||e("#"+r.queueID).remove(),n.siblings("input").remove(),n.show().insertBefore(i.button),i.button.remove(),"function"==typeof r.onDestroy&&r.onDestroy.call(n)})}};e.fn.uploadifive=function(n){return t[n]?t[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void e.error("The method "+n+" does not exist in $.uploadify"):t.init.apply(this,arguments)}}(jQuery);